import{_ as L,o as a,c as d,a as s,l as q,t as g,e as _,w as p,v as u,h as F,m as H,g as K,F as y,r as x,b as G,i as v,q as Q,d as l,k as W,s as X,p as Y,f as Z}from"./index.8d5433bf.js";import*as $ from"https://cdn.jsdelivr.net/npm/monaco-editor/+esm";import"https://cdn.jsdelivr.net/npm/@feathersjs/client@5.0.0-pre.28/+esm";import"https://cdn.jsdelivr.net/npm/socket.io-client@4.5.1/+esm";const ee={methods:{init(t){this.content=this.src;let e=$.editor.create(t.path[1],{value:this.content,language:this.lang||"javascript"});e.onDidChangeModelContent(()=>{this.content=e.getValue(),this.$emit("change",this.content)})}},data:()=>({content:""}),props:["src"],emits:["change"]},te={class:"editor"};function ie(t,e,o,r,f,n){return a(),d("div",te,[s("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",onLoad:e[0]||(e[0]=(...m)=>n.init&&n.init(...m))},null,32)])}const se=L(ee,[["render",ie],["__scopeId","data-v-be78c74e"]]);const ne={inject:["io"],methods:{setView(t){this.view=t},async saveType(){var e,o;await this.io.service("types/any").patch(this.instance._id,{title:this.instance.title,slug:this.instance.slug,status:this.instance.status,fields:this.instance.fieldsValue?JSON.parse(this.instance.fieldsValue):{},roles:this.instance.rolesValue?JSON.parse(this.instance.rolesValue):{},instance:new TextEncoder().encode((e=this.instance)==null?void 0:e.instanceValue).buffer,dashboard:new TextEncoder().encode((o=this.instance)==null?void 0:o.dashboardValue).buffer,owner:this.instance.owner,owner_group:this.instance.owner_group});let t=await this.io.service("types/any").get(this.instance._id);t.fieldsValue=t.fields?JSON.stringify(t.fields):"",t.rolesValue=t.roles?JSON.stringify(t.roles):"",t.instanceValue=new TextDecoder().decode(t.instance),t.dashboardValue=new TextDecoder().decode(t.dashboard),Object.assign(this.instance,t)},async removeType(){confirm("Confirm delete type?")&&(await this.io.service("types/any").remove(this.instance._id),this.$emit("list"),this.$router.push("/"))},async list(){let t=await this.io.service("types/any").find({query:{slug:this.type,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});t.data=t.data.map(e=>(e.fieldsValue=e.fields?JSON.stringify(e.fields):"",e.rolesValue=e.roles?JSON.stringify(e.roles):"",e.instanceValue=new TextDecoder().decode(e.instance),e.dashboardValue=new TextDecoder().decode(e.dashboard),e)),this.response=t,this.listRow()},async listRow(){let t={$or:[]};this.fields.forEach(o=>{var r;if(((r=this.keys[o])==null?void 0:r.type)==="String"){let f={};f[o]={$regex:this.search},t.$or.push(f)}}),(!t.$or.length||!this.search)&&delete t.$or;let e=await this.io.service("types/"+this.type).find({query:{...t,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});e.data=e.data.map(o=>this.decode(o)),this.responseRow=e},async create(t){await this.io.service("types/"+this.type).create(t),this.clear(),this.list()},async save(t){await this.io.service("types/"+this.type).patch(t._id,this.encode(t)),this.list()},async remove(t){await this.io.service("types/"+this.type).remove(t._id),this.list()},clear(){this.obj={}},decode(t){return Object.keys(this.keys).forEach(e=>{var f,n;let o=(f=this.keys[e])!=null&&f.intl?"object":(n=this.keys[e])==null?void 0:n.type;typeof o=="string"&&(o=o.toLowerCase());let r=o===typeof t[e]||o==="buffer"&&typeof t[e]=="object";if(r&&o==="object")try{t[e]=JSON.stringify(t[e])}catch{}else if(r&&o==="buffer")try{t[e]=new TextDecoder().decode(t[e])}catch{}}),t},encode(t){let e={...t};return Object.keys(this.keys).forEach(o=>{var n,m;let r=(n=this.keys[o])!=null&&n.intl?"object":(m=this.keys[o])==null?void 0:m.type;typeof r=="string"&&(r=r.toLowerCase());let f=typeof e[o];if(r==="object"&&f==="string")try{e[o]=JSON.parse(e[o])}catch{}else if(r==="buffer"&&f==="string")try{e[o]=new TextEncoder().encode(e[o]).buffer}catch{}}),e},nextPage(){this.page++,this.list()},prevPage(){this.page--,this.list()}},computed:{instance(){var t;return((t=this.response)==null?void 0:t.data[0])||{}},fields(){var e,o;(e=this.instance)!=null&&e.fields&&(this.keys=(o=this.instance)==null?void 0:o.fields);let t=Object.keys(this.keys);return this.fieldsSelected=t.slice(0,2),t},table(){var t;return((t=this.responseRow)==null?void 0:t.data)||[]},decodedContent(){var t,e,o;if((t=this.response)!=null&&t.data.length){let r=(o=(e=this.response)==null?void 0:e.data[0])==null?void 0:o.dashboard;return r=new TextDecoder().decode(r),r&&!this.loaded&&(this.view="custom",this.loaded=!0),r}return""},loadedComponent(){let t=URL.createObjectURL(new Blob([this.decodedContent],{type:"text/javascript"}));return q(async()=>await Q(()=>import(t),[]))}},data:()=>({keys:[],obj:{},limit:25,page:1,response:null,responseRow:null,search:"",custom:!0,view:"main",loaded:!1,fieldsSelected:[]}),props:{type:{type:String,default:"components"}},created(){this.list()},watch:{type(){this.list()},"instance._id"(){this.view="main"}},setup(){},components:{Editor:se}},h=t=>(Y("data-v-ed1ea5c9"),t=t(),Z(),t),oe={style:{display:"flex",height:"100%","font-family":"Arial, Helvetica, sans-serif"}},ae={style:{width:"100%","flex-grow":"1",flex:"1",height:"100%",overflow:"auto","background-color":"#edebebff"},class:"editor"},le={style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px"}},de={style:{color:"#2b2b2bff","font-weight":"100","font-size":"35px"}},re=l(),pe={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px"}},ce=["disabled"],ue=["disabled"],ge=["disabled"],he=["disabled"],me=["disabled"],fe=["disabled"],be=["disabled"],ye=l(),xe=l(),ve={key:0,style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#ffffffff"}},_e={key:1},we=["value"],ke={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","background-color":"#86a0b3ff",position:"relative","text-align":"center","margin-top":"10px","border-top-left-radius":"3px","border-top-right-radius":"3px"}},Ve={style:{color:"#38454dff"}},Ce=l(),Ae={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff","margin-bottom":"10px"},class:"row"},Se={style:{display:"inline-block"}},Ue=h(()=>s("input",{placeholder:"id",readonly:""},null,-1)),Re=["onUpdate:modelValue","placeholder"],Te=h(()=>s("input",{placeholder:"Created",readonly:""},null,-1)),Oe=h(()=>s("input",{placeholder:"Updated",readonly:""},null,-1)),Pe=l(),Ee={style:{display:"inline-block",float:"right"}},De=l(),Ne={style:{"box-sizing":"border-box","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","background-color":"#87acccff","border-top-left-radius":"3px","border-top-right-radius":"3px"},class:"row"},je=l(),Ie=l(),ze={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"0px","margin-bottom":"0px",position:"relative"},class:"row"},Be={style:{display:"inline-block",float:"right"}},Je=["onClick"],Le=l(),Me=["onClick"],qe=l(),Fe={style:{display:"inline-block"}},He=h(()=>s("div",null,null,-1)),Ke=["onUpdate:modelValue"],Ge=["onUpdate:modelValue","placeholder"],Qe=["onUpdate:modelValue"],We=["onUpdate:modelValue"],Xe=l(),Ye={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"10px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center"}},Ze={style:{color:"#38454dff"}},$e={key:2,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},et={key:3,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},tt={key:4,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},it={key:5,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},st={key:6,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},nt=h(()=>s("label",null," ID ",-1)),ot=l(),at=h(()=>s("label",null," Title ",-1)),lt=l(),dt=h(()=>s("label",null," Slug ",-1)),rt=l(),pt=h(()=>s("label",null," Status ",-1)),ct=l(),ut=h(()=>s("label",null," Owner ",-1)),gt=l(),ht=h(()=>s("label",null," Owner group ",-1)),mt=l(),ft=h(()=>s("label",null," Updated ",-1)),bt=l(),yt=h(()=>s("label",null," Created ",-1)),xt=l(),vt={style:{"margin-top":"20px"}},_t=l(),wt={style:{"margin-top":"20px"}};function kt(t,e,o,r,f,n){var b,w,k,V,C,A,S,U,R,T,O,P,E,D,N,j,I,z;const m=W("Editor");return a(),d("div",oe,[s("div",ae,[s("div",le,[s("h2",de,g((w=(b=n.instance)==null?void 0:b.title)==null?void 0:w.en),1)]),re,s("div",pe,[s("button",{type:"",onClick:e[0]||(e[0]=i=>t.view="main"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="main"},g((V=(k=n.instance)==null?void 0:k.title)==null?void 0:V.en),9,ce),n.decodedContent?(a(),d("button",{key:0,type:"",onClick:e[1]||(e[1]=i=>t.view="custom"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom"}," Custom view ",8,ue)):_("",!0),s("button",{type:"",onClick:e[2]||(e[2]=i=>t.view="fields"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="fields"}," Fields ",8,ge),s("button",{type:"",onClick:e[3]||(e[3]=i=>t.view="roles"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="roles"}," Roles ",8,he),s("button",{type:"",onClick:e[4]||(e[4]=i=>t.view="instance"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="instance"}," Instance ",8,me),s("button",{type:"",onClick:e[5]||(e[5]=i=>t.view="custom-editor"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom-editor"}," Custom editor ",8,fe),s("button",{type:"",onClick:e[6]||(e[6]=i=>t.view="type"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="type"}," Type ",8,be),p(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>n.instance.updatedAt=i),style:{"margin-left":"10px"}},null,512),[[u,n.instance.updatedAt]]),ye,s("button",{type:"",class:"green",onClick:e[8]||(e[8]=i=>n.saveType())}," Save ")]),xe,t.view==="custom"?(a(),d("div",ve,[(a(),F(H(n.loadedComponent)))])):t.view==="main"?(a(),d("div",_e,[p(s("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>t.fieldsSelected=i),multiple:"multiple",style:{"margin-left":"20px","margin-top":"10px",width:"calc(100% - 40px)"}},[(a(!0),d(y,null,x(n.fields,i=>(a(),d("option",{value:i},g(i),9,we))),256))],512),[[K,t.fieldsSelected]]),s("div",ke,[s("button",{type:"",onClick:e[10]||(e[10]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",Ve," Page "+g(t.page)+" of "+g(Math.ceil(((C=t.responseRow)==null?void 0:C.total)/((A=t.responseRow)==null?void 0:A.limit)))+" ("+g((S=t.responseRow)==null?void 0:S.skip)+" - "+g(((U=t.responseRow)==null?void 0:U.skip)+((T=(R=t.responseRow)==null?void 0:R.data)==null?void 0:T.length))+" of "+g((O=t.responseRow)==null?void 0:O.total)+") ",1),s("button",{type:"",onClick:e[11]||(e[11]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")]),Ce,s("div",Ae,[s("div",Se,[Ue,(a(!0),d(y,null,x(t.fieldsSelected,i=>p((a(),d("input",{"onUpdate:modelValue":c=>t.obj[i]=c,placeholder:i},null,8,Re)),[[u,t.obj[i]]])),256))]),Te,Oe,Pe,s("div",Ee,[s("button",{type:"",onClick:e[12]||(e[12]=i=>n.create(t.obj)),class:"green"}," Create ")])]),De,s("div",Ne,[p(s("input",{style:{"margin-right":"5px",width:"calc(100% - 110px)","padding-top":"15px","padding-bottom":"15px"},"onUpdate:modelValue":e[13]||(e[13]=i=>t.search=i),placeholder:"search...",onKeydown:e[14]||(e[14]=G((...i)=>n.list&&n.list(...i),["enter"]))},null,544),[[u,t.search]]),je,s("button",{type:"",onClick:e[15]||(e[15]=(...i)=>n.list&&n.list(...i)),class:"dark",style:{"padding-top":"15px","padding-bottom":"15px",width:"100px"}}," Search ")]),Ie,(a(!0),d(y,null,x(n.table,i=>(a(),d("div",ze,[s("div",Be,[s("button",{type:"",onClick:c=>n.remove(i),class:"red",style:{"margin-right":"2px"}}," Remove ",8,Je),Le,s("button",{type:"",onClick:c=>n.save(i),class:"green"}," Save ",8,Me)]),qe,s("div",Fe,[He,p(s("input",{placeholder:"ID","onUpdate:modelValue":c=>i._id=c,readonly:""},null,8,Ke),[[u,i._id]]),(a(!0),d(y,null,x(t.fieldsSelected,c=>{var B,J;return p((a(),d("input",{"onUpdate:modelValue":M=>i[c]=M,placeholder:c},null,8,Ge)),[[u,i[c]],[X,!((B=i[c])!=null&&B.en)&&!((J=i[c])!=null&&J.no)]])}),256)),p(s("input",{placeholder:"Updated","onUpdate:modelValue":c=>i.updatedAt=c,readonly:""},null,8,Qe),[[u,i.updatedAt]]),p(s("input",{placeholder:"Created","onUpdate:modelValue":c=>i.createdAt=c,readonly:""},null,8,We),[[u,i.createdAt]])])]))),256)),Xe,s("div",Ye,[s("button",{type:"",onClick:e[16]||(e[16]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",Ze," Page "+g(t.page)+" of "+g(Math.ceil(((P=t.responseRow)==null?void 0:P.total)/((E=t.responseRow)==null?void 0:E.limit)))+" ("+g((D=t.responseRow)==null?void 0:D.skip)+" - "+g(((N=t.responseRow)==null?void 0:N.skip)+((I=(j=t.responseRow)==null?void 0:j.data)==null?void 0:I.length))+" of "+g((z=t.responseRow)==null?void 0:z.total)+") ",1),s("button",{type:"",onClick:e[17]||(e[17]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")])])):t.view==="fields"?(a(),d("div",$e,[v(m,{onChange:e[18]||(e[18]=i=>n.instance.fieldsValue=i),src:n.instance.fieldsValue},null,8,["src"])])):t.view==="roles"?(a(),d("div",et,[v(m,{onChange:e[19]||(e[19]=i=>n.instance.rolesValue=i),src:n.instance.rolesValue},null,8,["src"])])):t.view==="instance"?(a(),d("div",tt,[v(m,{onChange:e[20]||(e[20]=i=>n.instance.instanceValue=i),src:n.instance.instanceValue},null,8,["src"])])):t.view==="custom-editor"?(a(),d("div",it,[v(m,{onChange:e[21]||(e[21]=i=>n.instance.dashboardValue=i),src:n.instance.dashboardValue},null,8,["src"])])):t.view==="type"?(a(),d("div",st,[s("div",null,[nt,p(s("input",{"onUpdate:modelValue":e[22]||(e[22]=i=>n.instance._id=i),readonly:"readonly"},null,512),[[u,n.instance._id]])]),ot,s("div",null,[at,n.instance.title?p((a(),d("input",{key:0,"onUpdate:modelValue":e[23]||(e[23]=i=>n.instance.title.en=i)},null,512)),[[u,n.instance.title.en]]):_("",!0)]),lt,s("div",null,[dt,p(s("input",{"onUpdate:modelValue":e[24]||(e[24]=i=>n.instance.slug=i)},null,512),[[u,n.instance.slug]])]),rt,s("div",null,[pt,p(s("input",{"onUpdate:modelValue":e[25]||(e[25]=i=>n.instance.status=i)},null,512),[[u,n.instance.status]])]),ct,s("div",null,[ut,p(s("input",{"onUpdate:modelValue":e[26]||(e[26]=i=>n.instance.owner=i)},null,512),[[u,n.instance.owner]])]),gt,s("div",null,[ht,p(s("input",{"onUpdate:modelValue":e[27]||(e[27]=i=>n.instance.owner_group=i)},null,512),[[u,n.instance.owner_group]])]),mt,s("div",null,[ft,p(s("input",{"onUpdate:modelValue":e[28]||(e[28]=i=>n.instance.updatedAt=i)},null,512),[[u,n.instance.updatedAt]])]),bt,s("div",null,[yt,p(s("input",{"onUpdate:modelValue":e[29]||(e[29]=i=>n.instance.createdAt=i)},null,512),[[u,n.instance.createdAt]])]),xt,s("div",vt,[s("button",{type:"",class:"green",onClick:e[30]||(e[30]=i=>n.saveType())}," Save ")]),_t,s("div",wt,[s("button",{type:"",class:"red",onClick:e[31]||(e[31]=i=>n.removeType())}," Delete ")])])):_("",!0)])])}const St=L(ne,[["render",kt],["__scopeId","data-v-ed1ea5c9"]]);export{St as default};
