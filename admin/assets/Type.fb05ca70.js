import{_ as L,o as d,c as l,a as s,l as M,t as g,e as x,w as c,v as u,h as F,m as H,F as v,r as _,b as K,i as y,q as G,d as r,k as Q,s as W,p as X,f as Y}from"./index.75c6dda8.js";import*as Z from"https://cdn.jsdelivr.net/npm/monaco-editor/+esm";import"https://cdn.jsdelivr.net/npm/@feathersjs/client@5.0.0-pre.28/+esm";import"https://cdn.jsdelivr.net/npm/socket.io-client@4.5.1/+esm";const $={methods:{init(t){this.content=this.src;let e=Z.editor.create(t.path[1],{value:this.content,language:this.lang||"javascript"});e.onDidChangeModelContent(()=>{this.content=e.getValue(),this.$emit("change",this.content)})}},data:()=>({content:""}),props:["src"],emits:["change"]},ee={class:"editor"};function te(t,e,o,a,b,n){return d(),l("div",ee,[s("img",{src:"data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",onLoad:e[0]||(e[0]=(...m)=>n.init&&n.init(...m))},null,32)])}const ie=L($,[["render",te],["__scopeId","data-v-be78c74e"]]);const se={inject:["io"],methods:{setView(t){this.view=t},async saveType(){var e,o;await this.io.service("types/any").patch(this.instance._id,{title:this.instance.title,slug:this.instance.slug,status:this.instance.status,fields:this.instance.fieldsValue?JSON.parse(this.instance.fieldsValue):{},roles:this.instance.rolesValue?JSON.parse(this.instance.rolesValue):{},instance:new TextEncoder().encode((e=this.instance)==null?void 0:e.instanceValue).buffer,dashboard:new TextEncoder().encode((o=this.instance)==null?void 0:o.dashboardValue).buffer,owner:this.instance.owner,owner_group:this.instance.owner_group});let t=await this.io.service("types/any").get(this.instance._id);t.fieldsValue=t.fields?JSON.stringify(t.fields):"",t.rolesValue=t.roles?JSON.stringify(t.roles):"",t.instanceValue=new TextDecoder().decode(t.instance),t.dashboardValue=new TextDecoder().decode(t.dashboard),Object.assign(this.instance,t)},async removeType(){confirm("Confirm delete type?")&&(await this.io.service("types/any").remove(this.instance._id),this.$emit("list"),this.$router.push("/"))},async list(){let t=await this.io.service("types/any").find({query:{slug:this.type,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});t.data=t.data.map(e=>(e.fieldsValue=e.fields?JSON.stringify(e.fields):"",e.rolesValue=e.roles?JSON.stringify(e.roles):"",e.instanceValue=new TextDecoder().decode(e.instance),e.dashboardValue=new TextDecoder().decode(e.dashboard),e)),this.response=t,this.listRow()},async listRow(){let t={$or:[]};this.fields.forEach(o=>{var a;if(((a=this.keys[o])==null?void 0:a.type)==="String"){let b={};b[o]={$regex:this.search},t.$or.push(b)}}),(!t.$or.length||!this.search)&&delete t.$or;let e=await this.io.service("types/"+this.type).find({query:{...t,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});e.data=e.data.map(o=>this.decode(o)),this.responseRow=e},async create(t){await this.io.service("types/"+this.type).create(t),this.clear(),this.list()},async save(t){await this.io.service("types/"+this.type).patch(t._id,this.encode(t)),this.list()},async remove(t){await this.io.service("types/"+this.type).remove(t._id),this.list()},clear(){this.obj={}},decode(t){return Object.keys(this.keys).forEach(e=>{var b,n;let o=(b=this.keys[e])!=null&&b.intl?"object":(n=this.keys[e])==null?void 0:n.type;typeof o=="string"&&(o=o.toLowerCase());let a=o===typeof t[e]||o==="buffer"&&typeof t[e]=="object";if(a&&o==="object")try{t[e]=JSON.stringify(t[e])}catch{}else if(a&&o==="buffer")try{t[e]=new TextDecoder().decode(t[e])}catch{}}),t},encode(t){let e={...t};return Object.keys(this.keys).forEach(o=>{var n,m;let a=(n=this.keys[o])!=null&&n.intl?"object":(m=this.keys[o])==null?void 0:m.type;typeof a=="string"&&(a=a.toLowerCase());let b=typeof e[o];if(a==="object"&&b==="string")try{e[o]=JSON.parse(e[o])}catch{}else if(a==="buffer"&&b==="string")try{e[o]=new TextEncoder().encode(e[o]).buffer}catch{}}),e},nextPage(){this.page++,this.list()},prevPage(){this.page--,this.list()}},computed:{instance(){var t;return((t=this.response)==null?void 0:t.data[0])||{}},fields(){var t,e;return(t=this.instance)!=null&&t.fields&&(this.keys=(e=this.instance)==null?void 0:e.fields),Object.keys(this.keys)},table(){var t;return((t=this.responseRow)==null?void 0:t.data)||[]},decodedContent(){var t,e,o;if((t=this.response)!=null&&t.data.length){let a=(o=(e=this.response)==null?void 0:e.data[0])==null?void 0:o.dashboard;return a=new TextDecoder().decode(a),a&&!this.loaded&&(this.view="custom",this.loaded=!0),a}return""},loadedComponent(){let t=URL.createObjectURL(new Blob([this.decodedContent],{type:"text/javascript"}));return M(async()=>await G(()=>import(t),[]))}},data:()=>({keys:[],obj:{},limit:25,page:1,response:null,responseRow:null,search:"",custom:!0,view:"main",loaded:!1}),props:{type:{type:String,default:"components"}},created(){this.list()},watch:{type(){this.list()},"instance._id"(){this.view="main"}},setup(){},components:{Editor:ie}},h=t=>(X("data-v-88c4683d"),t=t(),Y(),t),ne={style:{display:"flex",height:"100%","font-family":"Arial, Helvetica, sans-serif"}},oe={style:{width:"100%","flex-grow":"1",flex:"1",height:"100%",overflow:"auto","background-color":"#edebebff"},class:"editor"},ae={style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px"}},de={style:{color:"#2b2b2bff","font-weight":"100","font-size":"35px"}},le=r(),re={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px"}},pe=["disabled"],ce=["disabled"],ue=["disabled"],ge=["disabled"],he=["disabled"],me=["disabled"],be=["disabled"],fe=r(),ye=r(),xe={key:0,style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#ffffffff"}},ve={key:1},_e={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","background-color":"#86a0b3ff",position:"relative","text-align":"center","margin-top":"10px","border-top-left-radius":"3px","border-top-right-radius":"3px"}},we={style:{color:"#38454dff"}},ke=r(),Ve={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff","margin-bottom":"10px"},class:"row"},Ce={style:{display:"inline-block"}},Ae=h(()=>s("input",{placeholder:"id",readonly:""},null,-1)),Ue=["onUpdate:modelValue","placeholder"],Re=h(()=>s("input",{placeholder:"Created",readonly:""},null,-1)),Se=h(()=>s("input",{placeholder:"Updated",readonly:""},null,-1)),Te=r(),Oe={style:{display:"inline-block",float:"right"}},Pe=r(),Ee={style:{"box-sizing":"border-box","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","background-color":"#87acccff","border-top-left-radius":"3px","border-top-right-radius":"3px"},class:"row"},De=r(),Ne=r(),je={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"0px","margin-bottom":"0px",position:"relative"},class:"row"},Ie={style:{display:"inline-block",float:"right"}},ze=["onClick"],Be=r(),Je=["onClick"],Le=r(),qe={style:{display:"inline-block"}},Me=h(()=>s("div",null,null,-1)),Fe=["onUpdate:modelValue"],He=["onUpdate:modelValue","placeholder"],Ke=["onUpdate:modelValue"],Ge=["onUpdate:modelValue"],Qe=r(),We={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"10px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center"}},Xe={style:{color:"#38454dff"}},Ye={key:2,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},Ze={key:3,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},$e={key:4,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},et={key:5,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},tt={key:6,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},it=h(()=>s("label",null," ID ",-1)),st=r(),nt=h(()=>s("label",null," Title ",-1)),ot=r(),at=h(()=>s("label",null," Slug ",-1)),dt=r(),lt=h(()=>s("label",null," Status ",-1)),rt=r(),pt=h(()=>s("label",null," Owner ",-1)),ct=r(),ut=h(()=>s("label",null," Owner group ",-1)),gt=h(()=>s("label",null," Updated ",-1)),ht=h(()=>s("label",null," Created ",-1)),mt={style:{"margin-top":"20px"}},bt={style:{"margin-top":"20px"}};function ft(t,e,o,a,b,n){var f,w,k,V,C,A,U,R,S,T,O,P,E,D,N,j,I,z;const m=Q("Editor");return d(),l("div",ne,[s("div",oe,[s("div",ae,[s("h2",de,g((w=(f=n.instance)==null?void 0:f.title)==null?void 0:w.en),1)]),le,s("div",re,[s("button",{type:"",onClick:e[0]||(e[0]=i=>t.view="main"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="main"},g((V=(k=n.instance)==null?void 0:k.title)==null?void 0:V.en),9,pe),n.decodedContent?(d(),l("button",{key:0,type:"",onClick:e[1]||(e[1]=i=>t.view="custom"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom"}," Custom view ",8,ce)):x("",!0),s("button",{type:"",onClick:e[2]||(e[2]=i=>t.view="fields"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="fields"}," Fields ",8,ue),s("button",{type:"",onClick:e[3]||(e[3]=i=>t.view="roles"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="roles"}," Roles ",8,ge),s("button",{type:"",onClick:e[4]||(e[4]=i=>t.view="instance"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="instance"}," Instance ",8,he),s("button",{type:"",onClick:e[5]||(e[5]=i=>t.view="custom-editor"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom-editor"}," Custom editor ",8,me),s("button",{type:"",onClick:e[6]||(e[6]=i=>t.view="type"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="type"}," Type ",8,be),c(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>n.instance.updatedAt=i),style:{"margin-left":"10px"}},null,512),[[u,n.instance.updatedAt]]),fe,s("button",{type:"",class:"green",onClick:e[8]||(e[8]=i=>n.saveType())}," Save ")]),ye,t.view==="custom"?(d(),l("div",xe,[(d(),F(H(n.loadedComponent)))])):t.view==="main"?(d(),l("div",ve,[s("div",_e,[s("button",{type:"",onClick:e[9]||(e[9]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",we," Page "+g(t.page)+" of "+g(Math.ceil(((C=t.responseRow)==null?void 0:C.total)/((A=t.responseRow)==null?void 0:A.limit)))+" ("+g((U=t.responseRow)==null?void 0:U.skip)+" - "+g(((R=t.responseRow)==null?void 0:R.skip)+((T=(S=t.responseRow)==null?void 0:S.data)==null?void 0:T.length))+" of "+g((O=t.responseRow)==null?void 0:O.total)+") ",1),s("button",{type:"",onClick:e[10]||(e[10]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")]),ke,s("div",Ve,[s("div",Ce,[Ae,(d(!0),l(v,null,_(n.fields,i=>c((d(),l("input",{"onUpdate:modelValue":p=>t.obj[i]=p,placeholder:i},null,8,Ue)),[[u,t.obj[i]]])),256))]),Re,Se,Te,s("div",Oe,[s("button",{type:"",onClick:e[11]||(e[11]=i=>n.create(t.obj)),class:"green"}," Create ")])]),Pe,s("div",Ee,[c(s("input",{style:{"margin-right":"5px",width:"calc(100% - 110px)","padding-top":"15px","padding-bottom":"15px"},"onUpdate:modelValue":e[12]||(e[12]=i=>t.search=i),placeholder:"Search",onKeydown:e[13]||(e[13]=K((...i)=>n.list&&n.list(...i),["enter"]))},null,544),[[u,t.search]]),De,s("button",{type:"",onClick:e[14]||(e[14]=(...i)=>n.list&&n.list(...i)),class:"dark",style:{"padding-top":"15px","padding-bottom":"15px",width:"100px"}}," Search ")]),Ne,(d(!0),l(v,null,_(n.table,i=>(d(),l("div",je,[s("div",Ie,[s("button",{type:"",onClick:p=>n.remove(i),class:"red",style:{"margin-right":"2px"}}," Remove ",8,ze),Be,s("button",{type:"",onClick:p=>n.save(i),class:"green"}," Save ",8,Je)]),Le,s("div",qe,[Me,c(s("input",{placeholder:"ID","onUpdate:modelValue":p=>i._id=p,readonly:""},null,8,Fe),[[u,i._id]]),(d(!0),l(v,null,_(n.fields,p=>{var B,J;return c((d(),l("input",{"onUpdate:modelValue":q=>i[p]=q,placeholder:p},null,8,He)),[[u,i[p]],[W,!((B=i[p])!=null&&B.en)&&!((J=i[p])!=null&&J.no)]])}),256)),c(s("input",{placeholder:"Updated","onUpdate:modelValue":p=>i.updatedAt=p,readonly:""},null,8,Ke),[[u,i.updatedAt]]),c(s("input",{placeholder:"Created","onUpdate:modelValue":p=>i.createdAt=p,readonly:""},null,8,Ge),[[u,i.createdAt]])])]))),256)),Qe,s("div",We,[s("button",{type:"",onClick:e[15]||(e[15]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",Xe," Page "+g(t.page)+" of "+g(Math.ceil(((P=t.responseRow)==null?void 0:P.total)/((E=t.responseRow)==null?void 0:E.limit)))+" ("+g((D=t.responseRow)==null?void 0:D.skip)+" - "+g(((N=t.responseRow)==null?void 0:N.skip)+((I=(j=t.responseRow)==null?void 0:j.data)==null?void 0:I.length))+" of "+g((z=t.responseRow)==null?void 0:z.total)+") ",1),s("button",{type:"",onClick:e[16]||(e[16]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")])])):t.view==="fields"?(d(),l("div",Ye,[y(m,{onChange:e[17]||(e[17]=i=>n.instance.fieldsValue=i),src:n.instance.fieldsValue},null,8,["src"])])):t.view==="roles"?(d(),l("div",Ze,[y(m,{onChange:e[18]||(e[18]=i=>n.instance.rolesValue=i),src:n.instance.rolesValue},null,8,["src"])])):t.view==="instance"?(d(),l("div",$e,[y(m,{onChange:e[19]||(e[19]=i=>n.instance.instanceValue=i),src:n.instance.instanceValue},null,8,["src"])])):t.view==="custom-editor"?(d(),l("div",et,[y(m,{onChange:e[20]||(e[20]=i=>n.instance.dashboardValue=i),src:n.instance.dashboardValue},null,8,["src"])])):t.view==="type"?(d(),l("div",tt,[s("div",null,[it,c(s("input",{"onUpdate:modelValue":e[21]||(e[21]=i=>n.instance._id=i),readonly:"readonly"},null,512),[[u,n.instance._id]])]),st,s("div",null,[nt,n.instance.title?c((d(),l("input",{key:0,"onUpdate:modelValue":e[22]||(e[22]=i=>n.instance.title.en=i)},null,512)),[[u,n.instance.title.en]]):x("",!0)]),ot,s("div",null,[at,c(s("input",{"onUpdate:modelValue":e[23]||(e[23]=i=>n.instance.slug=i)},null,512),[[u,n.instance.slug]])]),dt,s("div",null,[lt,c(s("input",{"onUpdate:modelValue":e[24]||(e[24]=i=>n.instance.status=i)},null,512),[[u,n.instance.status]])]),rt,s("div",null,[pt,c(s("input",{"onUpdate:modelValue":e[25]||(e[25]=i=>n.instance.owner=i)},null,512),[[u,n.instance.owner]])]),ct,s("div",null,[ut,c(s("input",{"onUpdate:modelValue":e[26]||(e[26]=i=>n.instance.owner_group=i)},null,512),[[u,n.instance.owner_group]])]),s("div",null,[gt,c(s("input",{"onUpdate:modelValue":e[27]||(e[27]=i=>n.instance.updatedAt=i)},null,512),[[u,n.instance.updatedAt]])]),s("div",null,[ht,c(s("input",{"onUpdate:modelValue":e[28]||(e[28]=i=>n.instance.createdAt=i)},null,512),[[u,n.instance.createdAt]])]),s("div",mt,[s("button",{type:"",class:"green",onClick:e[29]||(e[29]=i=>n.saveType())}," Save ")]),s("div",bt,[s("button",{type:"",class:"red",onClick:e[30]||(e[30]=i=>n.removeType())}," Delete ")])])):x("",!0)])])}const _t=L(se,[["render",ft],["__scopeId","data-v-88c4683d"]]);export{_t as default};
