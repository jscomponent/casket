import{_ as B,o as a,c as d,l as q,a as s,t as c,b as o,e as w,w as p,v as g,h as F,m as K,g as H,F as y,r as x,d as G,i as v,k as Q,q as W,p as X,f as Y,s as Z}from"./index-60b11d5f.js";import*as $ from"https://cdn.jsdelivr.net/npm/monaco-editor/+esm";const ee={mounted(){this.content=this.src;let t=$.editor.create(this.$refs.editor,{value:this.content,language:this.lang||"javascript"});t.onDidChangeModelContent(()=>{this.content=t.getValue(),this.$emit("change",this.content)})},data:()=>({content:""}),props:["src"],emits:["change"]},te={class:"editor",ref:"editor"};function ie(t,e,l,r,m,n){return a(),d("div",te,null,512)}const se=B(ee,[["render",ie],["__scopeId","data-v-261cbd93"]]);const ne={inject:["io"],methods:{setView(t){this.view=t},async saveType(){var e,l;await this.io.service("types/any").patch(this.instance._id,{title:this.instance.title,slug:this.instance.slug,status:this.instance.status,fields:this.instance.fieldsValue?JSON.parse(this.instance.fieldsValue):{},roles:this.instance.rolesValue?JSON.parse(this.instance.rolesValue):{},instance:new TextEncoder().encode((e=this.instance)==null?void 0:e.instanceValue).buffer,dashboard:new TextEncoder().encode((l=this.instance)==null?void 0:l.dashboardValue).buffer,owner:this.instance.owner,owner_group:this.instance.owner_group});let t=await this.io.service("types/any").get(this.instance._id);t.fieldsValue=t.fields?JSON.stringify(t.fields,null,4):"",t.rolesValue=t.roles?JSON.stringify(t.roles,null,4):"",t.instanceValue=new TextDecoder().decode(t.instance),t.dashboardValue=new TextDecoder().decode(t.dashboard),Object.assign(this.instance,t)},async removeType(){confirm("Confirm delete type?")&&(await this.io.service("types/any").remove(this.instance._id),this.$emit("list"),this.$router.push("/"))},async list(){let t=await this.io.service("types/any").find({query:{slug:this.type,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});t.data=t.data.map(e=>(e.fieldsValue=e.fields?JSON.stringify(e.fields,null,4):"",e.rolesValue=e.roles?JSON.stringify(e.roles,null,4):"",e.instanceValue=new TextDecoder().decode(e.instance),e.dashboardValue=new TextDecoder().decode(e.dashboard),e)),this.response=t,this.listRow()},async listRow(){let t={$or:[]};this.fields.forEach(l=>{var r;if(((r=this.keys[l])==null?void 0:r.type)==="String"){let m={};m[l]={$regex:this.search},t.$or.push(m)}}),(!t.$or.length||!this.search)&&delete t.$or;let e=await this.io.service("types/"+this.type).find({query:{...t,$limit:this.limit,$skip:(this.page-1)*this.limit,$sort:{createdAt:-1}}});e.data=e.data.map(l=>this.decode(l)),this.responseRow=e},async create(t){await this.io.service("types/"+this.type).create(t),this.clear(),this.list()},async save(t){await this.io.service("types/"+this.type).patch(t._id,this.encode(t)),this.list()},async remove(t){await this.io.service("types/"+this.type).remove(t._id),this.list()},clear(){this.obj={}},decode(t){return Object.keys(this.keys).forEach(e=>{var m,n;let l=(m=this.keys[e])!=null&&m.intl?"object":(n=this.keys[e])==null?void 0:n.type;typeof l=="string"&&(l=l.toLowerCase());let r=l===typeof t[e]||l==="buffer"&&typeof t[e]=="object";if(r&&l==="object")try{t[e]=JSON.stringify(t[e],null,4)}catch{}else if(r&&l==="buffer")try{t[e]=new TextDecoder().decode(t[e])}catch{}}),t},encode(t){let e={...t};return Object.keys(this.keys).forEach(l=>{var n,f;let r=(n=this.keys[l])!=null&&n.intl?"object":(f=this.keys[l])==null?void 0:f.type;typeof r=="string"&&(r=r.toLowerCase());let m=typeof e[l];if(r==="object"&&m==="string")try{e[l]=JSON.parse(e[l])}catch{}else if(r==="buffer"&&m==="string")try{e[l]=new TextEncoder().encode(e[l]).buffer}catch{}}),e},nextPage(){this.page++,this.list()},prevPage(){this.page--,this.list()}},computed:{instance(){var t;return((t=this.response)==null?void 0:t.data[0])||{}},fields(){var e,l;(e=this.instance)!=null&&e.fields&&(this.keys=(l=this.instance)==null?void 0:l.fields);let t=Object.keys(this.keys);return this.fieldsSelected=t.slice(0,3),t},table(){var t;return((t=this.responseRow)==null?void 0:t.data)||[]},decodedContent(){var t,e,l;if((t=this.response)!=null&&t.data.length){let r=(l=(e=this.response)==null?void 0:e.data[0])==null?void 0:l.dashboard;return r=new TextDecoder().decode(r),r&&!this.loaded&&(this.view="custom",this.loaded=!0),r}return""},loadedComponent(){let t=URL.createObjectURL(new Blob([this.decodedContent],{type:"text/javascript"}));return q(async()=>await Z(()=>import(t),[]))}},data:()=>({keys:[],obj:{},limit:25,page:1,response:null,responseRow:null,search:"",custom:!0,view:"main",loaded:!1,fieldsSelected:[]}),props:{type:{type:String,default:"components"}},created(){this.list()},watch:{type(){this.list()},"instance._id"(){this.view="main"}},setup(){},components:{Editor:se}},h=t=>(X("data-v-585bc30f"),t=t(),Y(),t),le={style:{display:"flex",height:"100%","font-family":"Arial, Helvetica, sans-serif"}},oe={style:{width:"100%","flex-grow":"1",flex:"1",height:"100%",overflow:"auto","background-color":"#edebebff"},class:"editor"},ae={style:{"margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px"}},de={style:{color:"#2b2b2bff","font-weight":"100","font-size":"35px"}},re={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px"}},pe=["disabled"],ue=["disabled"],ge=["disabled"],ce=["disabled"],he=["disabled"],me=["disabled"],fe=["disabled"],be={key:0,style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"20px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#ffffffff"}},ye={key:1},xe=["value"],ve={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"15px","padding-bottom":"15px","margin-left":"20px","margin-right":"20px","background-color":"#86a0b3ff",position:"relative","text-align":"center","margin-top":"10px","border-top-left-radius":"3px","border-top-right-radius":"3px"}},we={style:{color:"#38454dff"}},_e={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff","margin-bottom":"10px"},class:"row"},ke={style:{display:"inline-block"}},Ve=h(()=>s("input",{placeholder:"id",readonly:""},null,-1)),Ce=["onUpdate:modelValue","placeholder"],Se=h(()=>s("input",{placeholder:"Created",readonly:""},null,-1)),Ue=h(()=>s("input",{placeholder:"Updated",readonly:""},null,-1)),Re={style:{display:"inline-block",float:"right"}},Te={style:{"box-sizing":"border-box","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","background-color":"#87acccff","border-top-left-radius":"3px","border-top-right-radius":"3px"},class:"row"},Oe={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"0px","margin-bottom":"0px",position:"relative"},class:"row"},Pe={style:{display:"inline-block",float:"right"}},Ae=["onClick"],De=["onClick"],Ne={style:{display:"inline-block"}},Ee=h(()=>s("div",null,null,-1)),je=["onUpdate:modelValue"],Ie=["onUpdate:modelValue","placeholder"],ze=["onUpdate:modelValue"],Je=["onUpdate:modelValue"],Le={style:{"box-sizing":"border-box",width:"calc(100% - 40px)","padding-left":"20px","padding-right":"20px","padding-top":"20px","padding-bottom":"20px","margin-left":"20px","margin-right":"20px","margin-top":"10px","margin-bottom":"20px","border-top-left-radius":"3px","border-top-right-radius":"3px","border-bottom-left-radius":"3px","border-bottom-right-radius":"3px","background-color":"#86a0b3ff",position:"relative","text-align":"center"}},Be={style:{color:"#38454dff"}},Me={key:2,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},qe={key:3,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},Fe={key:4,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},Ke={key:5,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},He={key:6,style:{"margin-right":"20px","margin-bottom":"20px","margin-left":"20px","margin-top":"10px",height:"calc(100% - 190px)"}},Ge=h(()=>s("label",null," ID ",-1)),Qe=h(()=>s("label",null," Title ",-1)),We=h(()=>s("label",null," Slug ",-1)),Xe=h(()=>s("label",null," Status ",-1)),Ye=h(()=>s("label",null," Owner ",-1)),Ze=h(()=>s("label",null," Owner group ",-1)),$e=h(()=>s("label",null," Updated ",-1)),et=h(()=>s("label",null," Created ",-1)),tt={style:{"margin-top":"20px"}},it={style:{"margin-top":"20px"}};function st(t,e,l,r,m,n){var b,_,k,V,C,S,U,R,T,O,P,A,D,N,E,j,I,z;const f=Q("Editor");return a(),d("div",le,[s("div",oe,[s("div",ae,[s("h2",de,c((_=(b=n.instance)==null?void 0:b.title)==null?void 0:_.en),1)]),o(),s("div",re,[s("button",{type:"",onClick:e[0]||(e[0]=i=>t.view="main"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="main"},c((V=(k=n.instance)==null?void 0:k.title)==null?void 0:V.en),9,pe),n.decodedContent?(a(),d("button",{key:0,type:"",onClick:e[1]||(e[1]=i=>t.view="custom"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom"}," Custom view ",8,ue)):w("",!0),s("button",{type:"",onClick:e[2]||(e[2]=i=>t.view="fields"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="fields"}," Fields ",8,ge),s("button",{type:"",onClick:e[3]||(e[3]=i=>t.view="roles"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="roles"}," Roles ",8,ce),s("button",{type:"",onClick:e[4]||(e[4]=i=>t.view="instance"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="instance"}," Instance ",8,he),s("button",{type:"",onClick:e[5]||(e[5]=i=>t.view="custom-editor"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="custom-editor"}," Custom editor ",8,me),s("button",{type:"",onClick:e[6]||(e[6]=i=>t.view="type"),class:"dark",style:{"margin-right":"2px"},disabled:t.view==="type"}," Type ",8,fe),p(s("input",{"onUpdate:modelValue":e[7]||(e[7]=i=>n.instance.updatedAt=i),style:{"margin-left":"10px"}},null,512),[[g,n.instance.updatedAt]]),o(),s("button",{type:"",class:"green",onClick:e[8]||(e[8]=i=>n.saveType())}," Save ")]),o(),t.view==="custom"?(a(),d("div",be,[(a(),F(K(n.loadedComponent)))])):t.view==="main"?(a(),d("div",ye,[p(s("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>t.fieldsSelected=i),multiple:"multiple",style:{"margin-left":"20px","margin-top":"10px",width:"calc(100% - 40px)",height:"104px"}},[(a(!0),d(y,null,x(n.fields,i=>(a(),d("option",{value:i},c(i),9,xe))),256))],512),[[H,t.fieldsSelected]]),s("div",ve,[s("button",{type:"",onClick:e[10]||(e[10]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",we," Page "+c(t.page)+" of "+c(Math.ceil(((C=t.responseRow)==null?void 0:C.total)/((S=t.responseRow)==null?void 0:S.limit)))+" ("+c((U=t.responseRow)==null?void 0:U.skip)+" - "+c(((R=t.responseRow)==null?void 0:R.skip)+((O=(T=t.responseRow)==null?void 0:T.data)==null?void 0:O.length))+" of "+c((P=t.responseRow)==null?void 0:P.total)+") ",1),s("button",{type:"",onClick:e[11]||(e[11]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")]),o(),s("div",_e,[s("div",ke,[Ve,(a(!0),d(y,null,x(t.fieldsSelected,i=>p((a(),d("input",{"onUpdate:modelValue":u=>t.obj[i]=u,placeholder:i},null,8,Ce)),[[g,t.obj[i]]])),256))]),Se,Ue,o(),s("div",Re,[s("button",{type:"",onClick:e[12]||(e[12]=i=>n.create(t.obj)),class:"green"}," Create ")])]),o(),s("div",Te,[p(s("input",{style:{"margin-right":"5px",width:"calc(100% - 110px)","padding-top":"15px","padding-bottom":"15px"},"onUpdate:modelValue":e[13]||(e[13]=i=>t.search=i),placeholder:"search...",onKeydown:e[14]||(e[14]=G((...i)=>n.list&&n.list(...i),["enter"]))},null,544),[[g,t.search]]),o(),s("button",{type:"",onClick:e[15]||(e[15]=(...i)=>n.list&&n.list(...i)),class:"dark",style:{"padding-top":"15px","padding-bottom":"15px",width:"100px"}}," Search ")]),o(),(a(!0),d(y,null,x(n.table,i=>(a(),d("div",Oe,[s("div",Pe,[s("button",{type:"",onClick:u=>n.remove(i),class:"red",style:{"margin-right":"2px"}}," Remove ",8,Ae),o(),s("button",{type:"",onClick:u=>n.save(i),class:"green"}," Save ",8,De)]),o(),s("div",Ne,[Ee,p(s("input",{placeholder:"ID","onUpdate:modelValue":u=>i._id=u,readonly:""},null,8,je),[[g,i._id]]),(a(!0),d(y,null,x(t.fieldsSelected,u=>{var J,L;return p((a(),d("input",{"onUpdate:modelValue":M=>i[u]=M,placeholder:u},null,8,Ie)),[[g,i[u]],[W,!((J=i[u])!=null&&J.en)&&!((L=i[u])!=null&&L.no)]])}),256)),p(s("input",{placeholder:"Updated","onUpdate:modelValue":u=>i.updatedAt=u,readonly:""},null,8,ze),[[g,i.updatedAt]]),p(s("input",{placeholder:"Created","onUpdate:modelValue":u=>i.createdAt=u,readonly:""},null,8,Je),[[g,i.createdAt]])])]))),256)),o(),s("div",Le,[s("button",{type:"",onClick:e[16]||(e[16]=(...i)=>n.prevPage&&n.prevPage(...i)),style:{float:"left","margin-top":"-5px"},class:"dark"}," Previous page "),s("span",Be," Page "+c(t.page)+" of "+c(Math.ceil(((A=t.responseRow)==null?void 0:A.total)/((D=t.responseRow)==null?void 0:D.limit)))+" ("+c((N=t.responseRow)==null?void 0:N.skip)+" - "+c(((E=t.responseRow)==null?void 0:E.skip)+((I=(j=t.responseRow)==null?void 0:j.data)==null?void 0:I.length))+" of "+c((z=t.responseRow)==null?void 0:z.total)+") ",1),s("button",{type:"",onClick:e[17]||(e[17]=(...i)=>n.nextPage&&n.nextPage(...i)),style:{float:"right","margin-top":"-5px"},class:"dark"}," Next page ")])])):t.view==="fields"?(a(),d("div",Me,[v(f,{onChange:e[18]||(e[18]=i=>n.instance.fieldsValue=i),src:n.instance.fieldsValue},null,8,["src"])])):t.view==="roles"?(a(),d("div",qe,[v(f,{onChange:e[19]||(e[19]=i=>n.instance.rolesValue=i),src:n.instance.rolesValue},null,8,["src"])])):t.view==="instance"?(a(),d("div",Fe,[v(f,{onChange:e[20]||(e[20]=i=>n.instance.instanceValue=i),src:n.instance.instanceValue},null,8,["src"])])):t.view==="custom-editor"?(a(),d("div",Ke,[v(f,{onChange:e[21]||(e[21]=i=>n.instance.dashboardValue=i),src:n.instance.dashboardValue},null,8,["src"])])):t.view==="type"?(a(),d("div",He,[s("div",null,[Ge,p(s("input",{"onUpdate:modelValue":e[22]||(e[22]=i=>n.instance._id=i),readonly:"readonly"},null,512),[[g,n.instance._id]])]),o(),s("div",null,[Qe,n.instance.title?p((a(),d("input",{key:0,"onUpdate:modelValue":e[23]||(e[23]=i=>n.instance.title.en=i)},null,512)),[[g,n.instance.title.en]]):w("",!0)]),o(),s("div",null,[We,p(s("input",{"onUpdate:modelValue":e[24]||(e[24]=i=>n.instance.slug=i)},null,512),[[g,n.instance.slug]])]),o(),s("div",null,[Xe,p(s("input",{"onUpdate:modelValue":e[25]||(e[25]=i=>n.instance.status=i)},null,512),[[g,n.instance.status]])]),o(),s("div",null,[Ye,p(s("input",{"onUpdate:modelValue":e[26]||(e[26]=i=>n.instance.owner=i)},null,512),[[g,n.instance.owner]])]),o(),s("div",null,[Ze,p(s("input",{"onUpdate:modelValue":e[27]||(e[27]=i=>n.instance.owner_group=i)},null,512),[[g,n.instance.owner_group]])]),o(),s("div",null,[$e,p(s("input",{"onUpdate:modelValue":e[28]||(e[28]=i=>n.instance.updatedAt=i)},null,512),[[g,n.instance.updatedAt]])]),o(),s("div",null,[et,p(s("input",{"onUpdate:modelValue":e[29]||(e[29]=i=>n.instance.createdAt=i)},null,512),[[g,n.instance.createdAt]])]),o(),s("div",tt,[s("button",{type:"",class:"green",onClick:e[30]||(e[30]=i=>n.saveType())}," Save ")]),o(),s("div",it,[s("button",{type:"",class:"red",onClick:e[31]||(e[31]=i=>n.removeType())}," Delete ")])])):w("",!0)])])}const lt=B(ne,[["render",st],["__scopeId","data-v-585bc30f"]]);export{lt as default};
